---
import Layout from "../../layouts/Layout.astro";
import OffreCard from "../../components/OffreCard.astro";
import PbImage from "../../components/PbImage.astro";
import { getOffres } from "../../backend.mjs";

const offres = await getOffres();
---

<Layout titre="Offres">
  <h1>Offres</h1>
  <a href="/offres/surface/80" class="underline">
    Voir les maisons de plus de 80 m²
  </a>

  <button id="favori-button" class="bg-slate-600 rounded-lg text-white p-2">
    Afficher les favoris
  </button>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
    {
      offres.map((offre) => (
        <div class="offre" data-favori={(offre.favori ?? false).toString()}>
          <OffreCard offre={offre} />
        </div>
      ))
    }
  </div>

  <script>
    const button = document.getElementById("favori-button");
    let showOnlyFavorites = false;

    button?.addEventListener("click", () => {
      showOnlyFavorites = !showOnlyFavorites;
      const offres = document.querySelectorAll(".offre");

      offres.forEach((offre) => {
        const isFavori = offre.dataset.favori === "true";

        if (showOnlyFavorites) {
          offre.style.display = isFavori ? "block" : "none";
          button.textContent = "Afficher tout";
        } else {
          offre.style.display = "block";
          button.textContent = "Afficher les favoris";
        }
      });
    });
  </script>
</Layout>

<a href="/offres/prix/3000" class="underline inline-block mb-4">
  Voir les maisons à moins de 3000 €
</a>
